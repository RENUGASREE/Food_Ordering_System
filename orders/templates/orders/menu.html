{% extends 'orders/base.html' %}
{% block content %}
<div class="d-flex flex-wrap align-items-center justify-content-between mb-3 gap-2">
  <h2 class="m-0">Menu</h2>
  <form class="d-flex gap-2" method="get">
    <select name="category" class="form-select form-select-sm" onchange="this.form.submit()">
      <option value="">All categories</option>
      {% for c in categories %}
        <option value="{{ c }}" {% if active_category == c %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
    <div class="form-check align-self-center">
      <input class="form-check-input" type="checkbox" name="veg" value="1" id="veg" {% if only_veg %}checked{% endif %} onchange="this.form.submit()">
      <label class="form-check-label" for="veg">Veg only</label>
    </div>
    <div class="form-check align-self-center ms-2">
      <input class="form-check-input" type="checkbox" name="nonveg" value="1" id="nonveg" {% if only_nonveg %}checked{% endif %} onchange="this.form.submit()">
      <label class="form-check-label" for="nonveg">Non-veg only</label>
    </div>
  </form>
</div>

{% for category, items in grouped.items %}
  <div class="mb-4">
    <h5 class="mb-3">{{ category }}</h5>
    <div class="row g-3">
      {% for item in items %}
      <div class="col-12 col-sm-6 col-lg-4">
        <div class="card h-100 shadow-sm" style="border-radius: 8px;">
          {% if item.image %}
          <img src="{{ item.image.url }}" class="card-img-top" alt="{{ item.name }}" style="width: 100%; height: auto; border-bottom: 1px solid #eee;">
          {% else %}
          <img src="https://via.placeholder.com/600x400.png?text=No+Image+Available" class="card-img-top" alt="No image for {{ item.name }}" style="width: 100%; height: auto; border-bottom: 1px solid #eee;">
          {% endif %}
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h6 class="card-title fw-semibold m-0">{{ item.name }}</h6>
              <span class="badge {% if item.is_veg %}bg-success{% else %}bg-danger{% endif %}">
                {% if item.is_veg %}Veg{% else %}Non‑veg{% endif %}
              </span>
            </div>
            <p class="text-muted mb-4">₹{{ item.price }}</p>
            <form method="post" action="{% url 'add_to_cart' %}" class="mt-auto">
              {% csrf_token %}
              <input type="hidden" name="item_id" value="{{ item.id }}">
              <div class="input-group">
                <input class="form-control" type="number" name="qty" min="1" value="1" aria-label="Quantity" required>
                <button class="btn btn-primary" type="submit">Add to cart</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
{% empty %}
  <div class="alert alert-warning">No menu items found.</div>
{% endfor %}
{% endblock %}