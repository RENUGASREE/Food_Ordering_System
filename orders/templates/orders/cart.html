{% extends 'orders/base.html' %}
{% load custom_filters %}
{% block content %}
<h2 class="mb-3">Your Cart</h2>
{% if order.lines.all %}
  <div class="table-responsive mb-3">
    <table class="table align-middle">
      <thead>
        <tr><th>Item</th><th class="text-center">Qty</th><th class="text-end">Price</th><th class="text-end">Line Total</th><th></th></tr>
      </thead>
      <tbody>
        {% for line in order.lines.all %}
        <tr>
          <td>{{ line.item.name }}</td>
          <td class="text-center" style="max-width: 120px;">
            <form method="post" action="{% url 'update_qty' %}" class="d-inline-flex gap-2">
              {% csrf_token %}
              <input type="hidden" name="line_id" value="{{ line.id }}">
              <input class="form-control form-control-sm" type="number" name="qty" min="0" value="{{ line.qty }}">
              <button class="btn btn-sm btn-outline-secondary" type="submit">Update</button>
            </form>
          </td>
          <td class="text-end">₹{{ line.item.price }}</td>
          <td class="text-end">₹{{ line.line_total }}</td>
          <td class="text-end">
            <form method="post" action="{% url 'update_qty' %}">
              {% csrf_token %}
              <input type="hidden" name="line_id" value="{{ line.id }}">
              <input type="hidden" name="qty" value="0">
              <button class="btn btn-sm btn-outline-danger">Remove</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th colspan="3" class="text-end">Subtotal</th>
          <th class="text-end">₹{{ order.subtotal }}</th>
          <th></th>
        </tr>
        {% for label, delta in adjustments %}
          {% if delta %}
          <tr>
            <th colspan="3" class="text-end">{{ label }}</th>
            <th class="text-end">{% if delta < 0 %}-{% endif %}₹{{ delta|absolute }}</th>
            <th></th>
          </tr>
          {% endif %}
        {% endfor %}
        <tr class="table-dark">
          <th colspan="3" class="text-end">Grand Total</th>
          <th class="text-end">₹{{ total }}</th>
          <th></th>
        </tr>
      </tfoot>
    </table>
  </div>
  <div class="d-flex justify-content-end">
    <a class="btn btn-outline-secondary me-2" href="{% url 'menu' %}">Continue shopping</a>
    <a class="btn btn-primary" href="{% url 'checkout' %}">Checkout</a>
  </div>
{% else %}
  <div class="alert alert-info">Your cart is empty.</div>
{% endif %}
{% endblock %}
